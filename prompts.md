# 진료 스케줄러 개발 프롬프트

## 사용 방법
- 각 Phase를 순서대로 진행하세요
- 하나의 Phase가 완료되면 다음 Phase 프롬프트를 사용하세요
- 각 프롬프트 시작 전 `@spec.md` 파일을 컨텍스트에 포함시키세요

---

## Phase 1: 프로젝트 초기 세팅 ✅ 완료

```
@spec.md 파일을 읽고 진료 스케줄러 프로젝트의 초기 세팅을 진행해주세요.

### 요구사항
1. Next.js 프로젝트 생성 (App Router, TypeScript)
2. 필수 의존성 설치:
   - Tailwind CSS
   - Zustand (상태 관리)
   - @heroicons/react (아이콘)
3. 기본 폴더 구조 생성:
   ```
   src/
   ├── app/
   │   ├── [year]/[month]/page.tsx
   │   ├── layout.tsx
   │   └── page.tsx (현재 월로 리다이렉트)
   ├── components/
   ├── stores/
   ├── types/
   ├── utils/
   └── data/
   ```
4. TypeScript 타입 정의 (spec.md의 데이터 스키마 참고):
   - Doctor, Schedule, Config 등 핵심 타입
5. Tailwind 설정 (한국어 폰트 포함)
6. 기본 레이아웃 컴포넌트

### 완료 기준
- `npm run dev`로 프로젝트가 정상 실행됨
- 기본 페이지가 표시됨
```

---

## Phase 1-2: 달력 UI 기본 구현 ✅ 완료

```
@spec.md 파일을 참고하여 달력 UI의 기본 구조를 구현해주세요.

### 요구사항
1. Calendar 컴포넌트 구현:
   - 일요일 시작
   - 동적 주 수 (4-6주, 해당 월에 맞게)
   - 이전/다음 달 날짜도 표시 (회색 처리)
2. CalendarHeader 컴포넌트:
   - 연/월 선택기 (이전/다음 버튼)
   - 현재 월 표시
3. CalendarCell 컴포넌트:
   - 날짜 표시
   - 의사별 스케줄 영역 (세로 분할)
   - 공휴일 표시 (빨간색 날짜, 공휴일명)
4. URL 라우팅:
   - `/` → 현재 월로 리다이렉트
   - `/2026/01` → 해당 월 캘린더

### 스타일 가이드 (spec.md 참고)
- 의사별 좌측 컬러 바
- 공간 부족 시 시간 축약 (09:00-18:00 → 09-18)
- 휴진은 회색 처리 + "휴진" 텍스트

### 완료 기준
- 달력이 정상적으로 렌더링됨
- 이전/다음 달 이동이 작동함
- URL이 월에 따라 변경됨
```

---

## Phase 1-3: Zustand 스토어 및 스케줄 자동 생성 ✅ 완료

```
@spec.md 파일을 참고하여 상태 관리와 스케줄 자동 생성 로직을 구현해주세요.

### 요구사항

1. Zustand 스토어 생성:
   ```typescript
   // stores/useConfigStore.ts - 마스터 데이터
   - hospital: { name: string }
   - doctors: Doctor[]
   - defaultSchedule: Record<string, WeeklySchedule>
   - recurringRules: RecurringRule[]
   - hospitalHolidays: Holiday[]

   // stores/useScheduleStore.ts - 월별 스케줄
   - schedules: Record<string, MonthSchedule>
   - generateSchedule(year, month): void
   - updateDaySchedule(date, doctorId, schedule): void
   ```

2. 스케줄 자동 생성 로직 (`utils/scheduleGenerator.ts`):
   - 기본 근무 패턴 적용
   - 반복 휴진 규칙 적용 (매주/격주/매월 n주차)
   - 공휴일 적용
   - **규칙 충돌 시**: 더 광범위한 휴진 적용
   - **수동 편집된 날짜**: 재생성 시에도 유지

3. 격주 패턴 계산 로직:
   - referenceDate 기준으로 홀수/짝수 주 계산
   - isOffWeek 플래그로 휴진 주 결정

4. '스케줄 생성' 버튼 추가:
   - 클릭 시 해당 월 스케줄 생성
   - 기존 수동 편집은 유지

### 테스트 데이터
- 의사 2명 (김원장, 이원장)
- 기본 근무: 월-금 09:00-18:00, 토 09:00-13:00
- 반복 규칙: 김원장 매주 수요일 오후 휴진

### 완료 기준
- 스케줄 생성 버튼 클릭 시 달력에 스케줄 표시됨
- 반복 규칙이 올바르게 적용됨
```

---

## Phase 1-4: 인라인 편집 기능 ✅ 완료

```
@spec.md 파일을 참고하여 인라인 편집 기능을 구현해주세요.

### 요구사항

1. 우클릭 컨텍스트 메뉴 구현:
   - 의사 영역 우클릭 시 메뉴 표시
   - 메뉴 항목: 휴진 처리 / 시간 변경 / 초기화

2. 시간 변경 기능:
   - TimePicker 컴포넌트 (5분 단위)
   - 시작/종료 시간 선택
   - 변경 시 isManualEdit: true 설정

3. 휴진 처리:
   - 클릭 시 즉시 휴진으로 변경
   - 휴진 상태에서 다시 클릭 시 기본 근무로 복구

4. 초기화:
   - 해당 날짜의 해당 의사 스케줄을 마스터 데이터 기반으로 복구
   - isManualEdit: false로 변경

5. 수동 편집 표시:
   - 수동 편집된 스케줄에 작은 아이콘(연필 등) 표시

### UI/UX
- 컨텍스트 메뉴는 클릭 위치에 표시
- 메뉴 외부 클릭 시 닫힘
- 삭제/초기화 시 확인 모달 표시

### 완료 기준
- 우클릭 메뉴가 정상 작동함
- 시간 변경이 즉시 반영됨
- 수동 편집 표시가 보임
```

---

## Phase 1-5: 설정 사이드바 ✅ 완료

```
@spec.md 파일을 참고하여 설정 사이드바를 구현해주세요.

### 요구사항

1. 접이식 사이드바 (우측):
   - 열기/닫기 토글 버튼
   - 4개 탭: 의사 관리 / 기본 근무 / 반복 규칙 / 병원 휴일

2. 의사 관리 탭:
   - 의사 추가 (최대 3명)
   - 이름 입력
   - 색상 선택 (컬러 피커)
   - 순서 변경 (드래그앤드롭)
   - 삭제 (확인 모달)

3. 기본 근무 설정 탭:
   - 의사 선택
   - 요일별 근무 시간 설정
   - TimePicker 사용 (5분 단위)
   - 휴진 체크박스

4. 반복 규칙 탭:
   - 규칙 추가/삭제
   - 유형 선택: 매주 / 격주 / 매월 n주차
   - 요일 선택
   - 시간대 선택: 전일 / 오전 / 오후
   - 격주의 경우: "이번 주가 휴진 주" 토글

5. 병원 휴일 탭:
   - 날짜 직접 선택
   - 연간 반복 설정 (매년 M월 D일)
   - 휴일명 입력

### 완료 기준
- 모든 설정이 저장되고 달력에 반영됨
- 설정 변경 시 기존 수동 편집은 유지됨
```

---

## Phase 1-6: PDF 내보내기 (심플 테마) ✅ 완료

```
@spec.md 파일을 참고하여 PDF 내보내기 기능을 구현해주세요.

### 요구사항

1. 의존성 설치:
   - jspdf
   - html2canvas

2. PDF 내보내기 모달:
   - 테마 선택 (Phase 1에서는 심플만)
   - 의사별 색상 On/Off
   - 미리보기 버튼 (새 탭)
   - 다운로드 버튼

3. PDF 생성 로직:
   - A4 세로 (Portrait)
   - 1페이지에 맞춤
   - html2canvas로 캘린더 영역 이미지화
   - 한글 폰트 완벽 지원

4. 시간 포맷 자동 조절:
   - 의사 1-2명: 전체 형식 (09:00-18:00)
   - 의사 3명: 축약 형식 (09-18)

5. 파일명 형식:
   - `[병원명]_2026년_1월_스케줄.pdf`

6. 심플 테마 스타일:
   - 흰색 배경
   - 검은색 그리드
   - 공휴일만 빨간색
   - 최소한의 색상

7. Ctrl+P 처리:
   - PDF 내보내기 모달로 리다이렉트

### 완료 기준
- PDF가 정상적으로 생성됨
- 한글이 깨지지 않음
- 새 탭에서 미리보기 가능
```

---

## Phase 2: Google 인증 및 저장

```
@spec.md 파일을 참고하여 Google OAuth 및 Drive 저장 기능을 구현해주세요.

### 요구사항

1. Google OAuth 2.0 연동:
   - 헤더에 로그인/로그아웃 버튼
   - 30일 자동 로그인 (토큰 저장)
   - 로그인 실패 시 자동으로 비로그인 모드 전환

2. Google Drive API 연동:
   - 폴더 생성: `/[병원명]_스케줄/`
   - config.json 저장/불러오기
   - schedules/YYYY-MM.json 저장/불러오기

3. 비로그인 모드:
   - sessionStorage에 데이터 저장
   - 로그인 권유 배너 표시
   - 탭 닫을 때까지 데이터 유지

4. 데이터 동기화:
   - 로그인 시 Drive에서 데이터 불러오기
   - 변경 시 자동 저장 (debounce 적용)
   - 저장 실패 시 에러 메시지 + 재시도 버튼

5. 로그아웃 시:
   - 로컬 데이터 유지
   - 다음 로그인 시 동기화

### 환경 변수
- NEXT_PUBLIC_GOOGLE_CLIENT_ID
- GOOGLE_API_KEY

### 완료 기준
- Google 로그인/로그아웃 정상 작동
- Drive에 데이터가 저장됨
- 새로고침 시 데이터 유지
```

---

## Phase 2-2: 설정 마법사

```
@spec.md 파일을 참고하여 최초 접속 시 설정 마법사를 구현해주세요.

### 요구사항

1. 마법사 표시 조건:
   - 최초 접속 시 (config 데이터 없음)
   - 의사가 0명일 때

2. 3단계 마법사:
   - Step 1: 병원명 입력
   - Step 2: 의사 등록 (이름, 색상)
   - Step 3: 기본 근무 시간 설정

3. UI/UX:
   - 진행률 표시 (1/3, 2/3, 3/3)
   - 이전/다음 버튼
   - 건너뛰기 버튼 (모든 단계에서 가능)

4. 건너뛰기 시:
   - 빈 설정으로 메인 화면 이동
   - 이후 사이드바에서 설정 가능

### 완료 기준
- 최초 접속 시 마법사 표시
- 마법사 완료 후 메인 화면으로 이동
- 설정한 데이터가 저장됨
```

---

## Phase 3: 고급 기능

```
@spec.md 파일을 참고하여 고급 기능들을 구현해주세요.

### 요구사항

1. 공휴일 연동 (하이브리드):
   - 정적 JSON 파일 (data/holidays.json)에 5년치 공휴일 데이터
   - 대체공휴일, 임시공휴일 포함
   - 사용자 직접 추가 기능

2. 월 전체 초기화 기능:
   - '스케줄 초기화' 버튼
   - 확인 모달 표시
   - 마스터 데이터 기반으로 재생성

3. PDF 추가 테마:
   - 미니멀 테마: 부드러운 배경색, 그림자 효과
   - 화려한 테마: 계절/자연 배경 (10종)
     - 봄: 벚꽃, 새싹, 나비
     - 여름: 바다, 해바라기, 수박
     - 가을: 단풍, 코스모스, 은행잎
     - 겨울: 눈꽃, 크리스마스, 설경

4. 이웃 달 클릭 시 이동:
   - 이전/다음 달 날짜 클릭 시 해당 월로 이동

### 완료 기준
- 공휴일이 달력에 표시됨
- PDF 테마 선택 가능
- 월 초기화 작동
```

---

## Phase 4: 수익화 준비

```
@spec.md 파일을 참고하여 수익화 준비 기능을 구현해주세요.

### 요구사항

1. Google Analytics 4 연동:
   - 페이지뷰 추적
   - 이벤트 추적 (PDF 다운로드, 로그인 등)

2. 개인정보처리방침 페이지:
   - /privacy 경로
   - 기본 개인정보처리방침 내용

3. 광고 인프라 준비 (코드만):
   - AdSense 스크립트 삽입 위치 주석
   - 광고 배너 컴포넌트 틀
   - 광고 On/Off 설정

4. 메타 태그 최적화:
   - Open Graph 태그
   - 검색엔진 최적화

### 완료 기준
- GA4 이벤트가 기록됨
- 개인정보처리방침 페이지 접근 가능
```

---

## 버그 수정 / 기능 개선 프롬프트 템플릿

```
@spec.md 파일을 참고하여 다음 [버그/기능]을 수정/개선해주세요.

### 현재 상황
[현재 동작 설명]

### 기대 동작
[spec.md 기준 올바른 동작]

### 재현 방법
1. [단계 1]
2. [단계 2]
3. [단계 3]

### 참고
- spec.md 섹션: [해당 섹션 번호]
```

---

## 전체 프로젝트 요약 프롬프트 (새 대화 시작 시)

```
진료 스케줄러 프로젝트를 이어서 작업합니다.

### 프로젝트 개요
- 병원 내 의사별 진료 스케줄을 관리하는 웹 애플리케이션
- PC 전용 (최소 1024px)
- Next.js + Zustand + Tailwind CSS

### 핵심 기능
1. 달력 기반 스케줄 표시/편집
2. 의사별 기본 근무 패턴 설정
3. 반복 휴진 규칙 (매주/격주/매월)
4. PDF 내보내기 (3가지 테마)
5. Google Drive 저장

### 기술 스택
- Next.js (App Router)
- Zustand (상태 관리)
- Tailwind CSS
- Heroicons
- jsPDF + html2canvas
- Google OAuth 2.0 + Drive API

### 상세 스펙
@spec.md 파일에 모든 요구사항이 정의되어 있습니다.

### 현재 작업
[현재 작업 중인 Phase 또는 기능]
```
