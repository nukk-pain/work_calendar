# [프로그램 명세서] 진료 스케줄러 - 웹 기반 맞춤형 진료 스케줄 관리 시스템

## 1. 개요 및 목적

### A. 서비스 정보
| 항목 | 내용 |
|------|------|
| **서비스명** | 진료 스케줄러 |
| **목적** | 병원 내 의사별 진료 스케줄을 매달 자동으로 생성하고 관리하며, A4 PDF 출력을 지원 |
| **플랫폼** | PC 전용 웹 서비스 (최소 해상도: 1024px) |
| **배포** | Vercel (Next.js) |
| **사용자** | 단일 관리자 |
| **지역** | 대한민국 (달력, 공휴일 기준) |
| **다크모드** | 미지원 (라이트 모드 전용) |

### B. 페이지 타이틀 형식
```
[병원명] - 2026년 1월 스케줄 | 진료 스케줄러
```

---

## 2. 기술 스택

### A. 프론트엔드
| 구분 | 기술 | 비고 |
|------|------|------|
| 프레임워크 | Next.js (React) | App Router 사용 |
| 상태 관리 | Zustand | 가벼운 상태 관리, 간결한 API |
| 스타일링 | Tailwind CSS | 유틸리티 퍼스트 |
| 아이콘 | Heroicons | Tailwind 공식 아이콘 |
| PDF 생성 | jsPDF + html2canvas | 캘린더 전체 이미지화 방식 |

### B. 백엔드/인프라
| 구분 | 기술 | 비고 |
|------|------|------|
| 배포 | Vercel | Next.js 최적화 |
| 인증 | Google OAuth 2.0 | 30일 자동 로그인 유지 |
| 저장소 | Google Drive API | 사용자 본인의 드라이브에 JSON 저장 |
| 공휴일 데이터 | 하이브리드 | 정적 JSON + 연 1회 자동 갱신 + 사용자 수동 추가 |

### C. 테스트
| 구분 | 기술 | 범위 |
|------|------|------|
| 단위 테스트 | Jest | 핵심 로직만 (스케줄 생성, 반복 규칙 계산 등) |

---

## 3. 핵심 데이터 구조

### A. 의사 정보
| 항목 | 설명 |
|------|------|
| 최대 인원 | 3명 (초기 버전, 향후 확장 가능하게 설계) |
| 저장 정보 | 이름, 고유 색상 (HEX/RGB 자유 선택), 표시 순서 |
| 색상 선택 | 컬러 피커 (전체 색상 선택 가능) |
| 순서 지정 | 드래그앤드롭으로 사용자가 직접 순서 지정 |

### B. 근무 시간 형식
| 항목 | 설명 |
|------|------|
| 표시 형식 | `HH:MM-HH:MM` (예: `09:00-12:00`, `14:00-18:00`) |
| 최소 단위 | 5분 단위 (09:00, 09:05, 09:10...) |
| 입력 방식 | TimePicker 컴포넌트 |
| 반일 근무 | 오전만, 오후만, 조기 퇴근 가능 |

### C. 반복 일정 패턴
| 패턴 유형 | 예시 |
|-----------|------|
| 매주 특정 요일 | 매주 수요일 오후 휴진 |
| 격주 특정 요일 | 격주 토요일 휴진 (기준주 사용자 지정) |
| 매월 특정 주차+요일 | 매월 첫째 주 월요일 휴진 |

#### 격주 패턴 기준주 설정
- 사용자가 직접 "이번 주가 휴진 주" 또는 "근무 주"인지 선택
- 선택 시점을 기준으로 격주 계산

#### 반복 규칙 충돌 시 처리
- **더 광범위한 휴진 적용**: 오후만 휴진 vs 전일 휴진 충돌 시 → 전일 휴진으로 처리

### D. 수동 편집 우선순위
- **수동 편집 유지**: 한 번 수동 편집한 날짜는 마스터 패턴 변경에 영향받지 않음 (잠금 처리)
- 수동 편집된 날짜는 시각적으로 구분 표시 (예: 작은 아이콘)

---

## 4. 주요 기능

### A. 설정 마법사 (최초 접속 시)

#### 단계별 구성
| 단계 | 내용 |
|------|------|
| 1단계 | 병원명 입력 |
| 2단계 | 의사 등록 (이름, 색상) |
| 3단계 | 기본 근무 시간 설정 (요일별) |

- **건너뛰기 가능**: '건너뛰기' 버튼으로 즉시 메인 화면 이동 가능
- 이후 설정 패널에서 언제든 수정 가능

### B. 마스터 데이터 설정

#### 1. 병원 정보
- 병원명 입력 (웹 UI 헤더 + PDF에 표시)
- Google Drive 폴더명에 자동 반영: `/[병원명]_스케줄/`

#### 2. 의사 등록 (최대 3명)
- 이름 입력
- 고유 색상 지정 (컬러 피커)
- 표시 순서 지정 (드래그앤드롭)

#### 3. 기본 근무 패턴 설정 (의사별)
- 요일별 기본 근무 시간 설정
- 예: 월~금 `09:00-18:00`, 토 `09:00-13:00`, 일 `휴진`

#### 4. 반복 휴진 규칙 설정
- 특정 요일/주차에 반복되는 휴진 패턴 등록
- 격주 패턴: 기준주 사용자 지정
- 예: "김원장 - 매주 수요일 오후 휴진"

#### 5. 병원 정기 휴일 등록
| 유형 | 설명 |
|------|------|
| 법정 공휴일 | 자동 연동 (하이브리드 방식) |
| 사용자 지정 휴일 | 특정 날짜 직접 선택 |
| 연간 반복 휴일 | 매년 반복 패턴 (예: 매년 3월 15일 개원기념일) |

### C. 월간 스케줄 생성 및 편집

#### 1. 스케줄 자동 생성
- **트리거**: '스케줄 생성' 버튼 클릭 시 생성
- 마스터 데이터 기반으로 해당 월 스케줄 자동 생성

#### 2. 인라인 편집
- 캘린더 셀 내에서 직접 편집 (compact UI)
- **우클릭 컨텍스트 메뉴**: 휴진 처리 / 시간 변경 / 초기화 선택

#### 3. 스케줄 초기화
- **월 전체 초기화**: 해당 월 스케줄을 마스터 데이터 기반으로 재생성
- 초기화 전 확인 모달 표시

### D. 의사 삭제 시 데이터 처리
- **과거 월 데이터**: 보존 (PDF 출력 시에도 표시)
- **현재/미래 월 데이터**: 삭제

### E. PDF 출력

#### 기본 사양
| 항목 | 사양 |
|------|------|
| 용지 | A4, 세로(Portrait) |
| 페이지 수 | 1매 |
| 출력 정보 | 병원명, 월, 의사 이름, 근무 시간 |
| 색상 옵션 | 의사별 고유 색상 적용 On/Off |
| 테마 선택 | 심플 / 미니멀 / 화려한 (10종 이상) |
| 생성 방식 | html2canvas 이미지화 (한글 폰트 완벽 지원) |

#### 시간 표시 포맷
- **자동 조절**: 의사 수에 따라 자동으로 결정
  - 의사 1-2명: 전체 형식 (`09:00-18:00`)
  - 의사 3명: 축약 형식 (`09-18`)

#### 파일명 형식
```
[병원명]_2026년_1월_스케줄.pdf
```

#### PDF 미리보기
- 브라우저 새 탭에서 PDF 미리보기 후 다운로드

#### PDF 테마 상세

##### 기본 테마
| 테마 | 특징 | 용도 |
|------|------|------|
| **심플** | 깔끔한 흑백 테이블, 최소한의 색상 | 오피스 출력, 잉크 절약 |
| **미니멀** | 현대적이고 세련된, 부드러운 배경색 | 디지털 공유, SNS |
| **화려한** | 배경 일러스트, 계절/자연 테마 | 병원 게시판, 환자 안내 |

##### 화려한 테마 종류 (계절/자연 컨셉, 10종 이상)
| 계절 | 테마 예시 |
|------|----------|
| 봄 | 벚꽃, 새싹, 나비 |
| 여름 | 바다, 해바라기, 수박 |
| 가을 | 단풍, 코스모스, 은행잎 |
| 겨울 | 눈꽃, 크리스마스, 설경 |

### F. 브라우저 인쇄 (Ctrl+P)
- PDF 내보내기 모달로 리다이렉트
- "인쇄하려면 PDF를 먼저 다운로드하세요" 안내

---

## 5. 달력 UI 레이아웃

### A. 기본 구조
| 항목 | 설명 |
|------|------|
| 주 시작 요일 | 일요일 (대한민국 표준) |
| 레이아웃 | 동적 조절 (해당 월에 필요한 주 수만큼 4-6주) |
| 이웃 달 표시 | 스케줄까지 표시 (클릭 시 해당 월로 이동) |
| 공휴일 표시 | 날짜 숫자 아래에 공휴일명 표시, 빨간색 강조 |

### B. 달력 예시
```
┌────────────────────────────────────────────────┐
│          OO병원 - 2026년 1월                    │
├──────┬──────┬──────┬──────┬──────┬──────┬──────┤
│  일  │  월  │  화  │  수  │  목  │  금  │  토  │
├──────┼──────┼──────┼──────┼──────┼──────┼──────┤
│  28  │  29  │  30  │  31  │  1   │  2   │  3   │
│(12월)│(12월)│(12월)│(12월)│신정  │      │      │
│      │      │      │      │ ──── │ ──── │ ──── │
│      │      │      │      │ 휴진 │김원장│김원장│
│      │      │      │      │      │09-18 │09-13 │
└──────┴──────┴──────┴──────┴──────┴──────┴──────┘
```

### C. 셀 내부 레이아웃 (세로 분할)
```
┌─────────────┐
│     15      │  ← 날짜
├─────────────┤
│ ■ 김원장    │  ← 색상 바 + 이름
│   09:00-18:00│     (우클릭 → 컨텍스트 메뉴)
├─────────────┤
│ ■ 이원장    │
│   09:00-16:00│
├─────────────┤
│ ■ 박원장    │
│   14:00-18:00│
└─────────────┘
```

### D. 가독성 향상 전략
| 전략 | 설명 |
|------|------|
| 색상 코딩 | 각 의사에게 고유 색상 부여 (좌측 컬러 바) |
| 시간 축약 | 공간 부족 시 `09:00-18:00` → `09-18` |
| 휴진 표시 | 회색 처리 + "휴진" 텍스트 |
| 공휴일 강조 | 날짜 빨간색, 공휴일명 표시 |
| 수동 편집 표시 | 수동 편집된 날짜에 작은 아이콘 표시 |

---

## 6. 사용자 인터페이스 구성

### A. URL 구조
```
/                    → 현재 월로 리다이렉트
/2026/01             → 2026년 1월 캘린더
/2026/01/settings    → 설정 페이지 (또는 사이드바)
```

### B. 메인 화면 레이아웃
| 영역 | 설명 |
|------|------|
| 상단 헤더 | 병원명, 연/월 선택기, PDF 내보내기 버튼, 로그인 버튼 |
| 중앙 | 달력 그리드 (인라인 편집 가능) |
| 우측 사이드바 | 설정 패널 (접이식) |

### C. 설정 패널 탭
| 탭 | 내용 |
|----|------|
| 의사 관리 | 의사 추가/수정/삭제, 색상 지정, 순서 변경 |
| 기본 근무 설정 | 요일별 기본 시간 설정 |
| 반복 규칙 | 반복 휴진 패턴 관리, 격주 기준주 설정 |
| 병원 휴일 | 정기 휴일 관리 (날짜 선택 + 연간 반복) |

### D. PDF 내보내기 다이얼로그
| 항목 | 설명 |
|------|------|
| 테마 선택 | 심플 / 미니멀 / 화려한 (10종 이상 중 선택) |
| 색상 옵션 | 의사별 색상 On/Off |
| 시간 형식 | 자동 (의사 수에 따라 결정) |
| 미리보기 | 새 탭에서 미리보기 |
| 다운로드 | 병원명 포함 파일명으로 다운로드 |

### E. 삭제/초기화 확인
- 간단한 확인 모달: "정말 삭제하시겠습니까?" + 확인/취소 버튼

### F. 로딩 상태
- 중앙 스피너 아이콘

---

## 7. 데이터 관리

### A. 인증
| 항목 | 설명 |
|------|------|
| 방식 | Google OAuth 2.0 |
| 세션 유지 | 30일 자동 로그인 (토큰 저장) |
| 로그인 UI | 헤더에 '로그인' 버튼 |
| 로그인 실패 | 자동으로 비로그인 모드 전환, 재로그인 버튼 표시 |

### B. Google Drive 저장소
```
/[병원명]_스케줄/
  ├── config.json       (의사 정보, 기본 근무 패턴, 반복 규칙, 병원 정보)
  └── schedules/
      ├── 2026-01.json  (월별 스케줄 데이터)
      ├── 2026-02.json
      └── ...
```

### C. 비로그인 모드
| 항목 | 설명 |
|------|------|
| 데이터 저장 | sessionStorage (탭 닫을 때까지 유지, 새로고침에는 유지) |
| 기능 제한 | Google Drive 저장/불러오기 불가 |
| 안내 | 로그인 시 데이터 영구 저장 가능 안내 배너 |

### D. 로그아웃 시 데이터 처리
- **로컬 데이터 유지**: 로그아웃해도 로컬 데이터 유지
- 다음 로그인 시 자동 동기화

### E. 동시 편집 처리
- **동기화 없음**: 마지막 저장이 덮어쓰기
- 단일 관리자 사용 가정

### F. 오프라인/네트워크 오류 처리
- 저장 실패 시 오류 메시지 표시 + 재시도 버튼
- 별도 로컬 캐싱 없음

---

## 8. 공휴일 데이터 관리

### A. 하이브리드 방식
| 구분 | 설명 |
|------|------|
| 기본 데이터 | 정적 JSON 파일 (5년치 미리 입력) |
| 자동 갱신 | 연 1회 공공데이터포털 API로 갱신 시도 |
| 수동 추가 | 사용자가 직접 공휴일 추가 가능 (임시공휴일 등) |
| 폴백 | API 실패 시 정적 JSON 사용 |

### B. 공휴일 표시
- 날짜 숫자: 빨간색
- 공휴일명: 날짜 아래에 작은 텍스트로 표시
- 배경: 연한 빨간색 (선택적)

---

## 9. 배포 시 주의사항 (Vercel)

### A. Google Cloud Console 설정
```
OAuth 리다이렉트 URI:
- 개발: http://localhost:3000
- 프로덕션: https://your-app.vercel.app
```

### B. 환경 변수
```
GOOGLE_CLIENT_ID=xxx
GOOGLE_API_KEY=xxx
```

---

## 10. 비용 구조 및 수익화 전략

### A. 서비스 운영 방식
| 항목 | 내용 |
|------|------|
| 배포 범위 | 외부 공개 (누구나 사용 가능) |
| 과금 모델 | 무료 |
| 수익화 | 사용자 수 증가 시 광고 삽입 고려 |

### B. 호스팅 비용 (Vercel)
| 단계 | 사용자 수 | 티어 | 월 비용 |
|------|----------|------|---------|
| Phase 1 | ~100명 | Hobby (Free) | $0 |
| Phase 2+ | 100명 이상 | Pro | $20 |

### C. Google API 비용
| API | 무료 한도 | 비고 |
|-----|----------|------|
| Drive API | 20,000 요청/일 | 충분 |
| OAuth 2.0 | 무제한 | 항상 무료 |

### D. 사용자 추적 및 분석
| 도구 | 비용 | 용도 |
|------|------|------|
| Google Analytics 4 | 무료 | 방문자 수, 사용 패턴 |

### E. 광고 수익화 계획
| 항목 | 내용 |
|------|------|
| 도입 기준 | 월 사용자 100명 이상 |
| 광고 플랫폼 | Google AdSense |
| 광고 위치 | 미정 (도입 시점에 결정) |
| 필수 준비 | 개인정보처리방침 페이지, 쿠키 동의 배너 |

---

## 11. 접근성 및 국제화

### A. 웹 접근성
- 기본 수준: 시멘틱 HTML, alt 텍스트 등

### B. 언어
- 한국어 전용
- 모든 에러 메시지 한국어로 표시

---

## 12. 성능 최적화

### A. 최적화 수준
- Next.js 기본 최적화만 적용
- 추가적인 SSG, 캐싱 전략 미적용

---

## 13. 제외된 기능 (Out of Scope)

| 기능 | 제외 이유 |
|------|----------|
| 병원 로고 삽입 | 복잡도 증가 |
| 휴진 사유 표시 | 불필요 |
| 변경 이력/로그 | 복잡도 증가 |
| 모바일 지원 | PC 전용 |
| 다중 사용자 동시 편집 | 단일 관리자 |
| 다크모드 | 불필요 |
| 키보드 단축키 | 불필요 |
| 튜토리얼/온보딩 | 직관적 UI로 대체 |
| 실시간 동기화 | 복잡도 증가 |

---

## 14. 개발 우선순위 제안

### Phase 1: MVP
1. 프로젝트 세팅 (Next.js + Tailwind + Zustand)
2. 기본 달력 UI 구현
3. 의사/근무 패턴 설정 기능
4. 스케줄 자동 생성 로직
5. 인라인 편집 기능
6. PDF 내보내기 (심플 테마)

### Phase 2: 인증 및 저장
1. Google OAuth 연동
2. Google Drive 저장/불러오기
3. 비로그인 모드 (sessionStorage)
4. 설정 마법사

### Phase 3: 고급 기능
1. 반복 휴진 규칙 (격주 포함)
2. 공휴일 연동 (하이브리드)
3. PDF 추가 테마 (미니멀, 화려한 10종)
4. 병원 정기 휴일

### Phase 4: 수익화 준비
1. Google Analytics 연동
2. 광고 인프라 준비
3. 개인정보처리방침 페이지

---

## 15. 데이터 스키마 (참고)

### config.json
```json
{
  "hospital": {
    "name": "OO병원"
  },
  "doctors": [
    {
      "id": "d1",
      "name": "김원장",
      "color": "#FF5733",
      "order": 0,
      "active": true
    }
  ],
  "defaultSchedule": {
    "d1": {
      "mon": { "start": "09:00", "end": "18:00" },
      "tue": { "start": "09:00", "end": "18:00" },
      "wed": { "start": "09:00", "end": "13:00" },
      "thu": { "start": "09:00", "end": "18:00" },
      "fri": { "start": "09:00", "end": "18:00" },
      "sat": { "start": "09:00", "end": "13:00" },
      "sun": null
    }
  },
  "recurringRules": [
    {
      "id": "r1",
      "doctorId": "d1",
      "type": "weekly",
      "dayOfWeek": 3,
      "period": "afternoon",
      "description": "매주 수요일 오후 휴진"
    },
    {
      "id": "r2",
      "doctorId": "d1",
      "type": "biweekly",
      "dayOfWeek": 6,
      "isOffWeek": true,
      "referenceDate": "2026-01-04",
      "description": "격주 토요일 휴진"
    }
  ],
  "hospitalHolidays": [
    {
      "id": "h1",
      "type": "fixed",
      "date": "2026-03-15",
      "name": "개원기념일"
    },
    {
      "id": "h2",
      "type": "yearly",
      "month": 3,
      "day": 15,
      "name": "개원기념일"
    }
  ]
}
```

### schedules/2026-01.json
```json
{
  "year": 2026,
  "month": 1,
  "generatedAt": "2026-01-01T00:00:00Z",
  "days": {
    "1": {
      "isHoliday": true,
      "holidayName": "신정",
      "doctors": {
        "d1": { "status": "off" },
        "d2": { "status": "off" }
      }
    },
    "2": {
      "isHoliday": false,
      "doctors": {
        "d1": {
          "status": "work",
          "start": "09:00",
          "end": "18:00",
          "isManualEdit": false
        },
        "d2": {
          "status": "work",
          "start": "09:00",
          "end": "16:00",
          "isManualEdit": true
        }
      }
    }
  }
}
```

---

## 16. 버전 정보

| 버전 | 날짜 | 변경 사항 |
|------|------|----------|
| 1.0 | 2026-01-20 | 초기 명세서 작성 |
| 2.0 | 2026-01-20 | 상세 인터뷰 기반 전면 개정 |
